# IP와 MAC

---

## 1. IP(Internet Protocol)

### ✅ 정의
인터넷에서 데이터 패킷이 출발지에서 목적지까지 전달될 수 있도록 하는 네트워크 계층 프로토콜이며, TCP/IP 스택의 인터넷 계층에서 작동한다.

### ✅ 주요 기능
- **주소 지정**: 각 장치에 고유한 IP 주소를 할당하여 식별 가능하게 함  
  - IPv4 (32비트), IPv6 (128비트) 공존 중
- **라우팅**: 목적지까지 최적 경로 탐색 및 전달 (라우터가 IP 기반으로 다음 목적지 결정)
- **단편화 및 재조립**: 
  - 큰 패킷 → 네트워크 MTU에 맞게 조각화
  - 목적지에서 재조립하여 원래 데이터로 복원

### ✅ 특징
- 비연결성: 사전 연결 없이 데이터 전송
- 신뢰성 없음: 패킷 손실, 순서 변경 가능 (보완은 TCP가 담당)
- 최선형 전달: 전송 실패 시 자체 복구 X

### ✅ 사용 분야
- **인터넷 기반 서비스**: 웹, 이메일, 파일 전송 등
- **로컬 네트워크**: 가정/회사 LAN, WAN 통신
- **라우팅 정보 교환**: 라우터 간 경로 정보 공유
- **클라우드 인프라**: VM, 컨테이너 통신, SDN 기반 통신
- **IoT 장치 연결**: 스마트홈, 센서 네트워크 등

---

## 2. MAC(Media Access Control)

### ✅ 정의
NIC(네트워크 인터페이스 카드)에 할당된 고유한 물리 주소. 48비트(16진수 표기)

### ✅ MAC 주소 구조
- 앞 24비트: 제조사 식별자 (OUI)
- 뒤 24비트: 장치 고유 번호

### ✅ MAC 주소의 역할
- 장치 식별: LAN 내 송수신 장비 식별
- 데이터 링크 계층 통신 (2계층): Ethernet, Wi-Fi 등에서 사용
- 프레임 전송: 이더넷 헤더에 출발지/목적지 MAC 포함
- ARP와 연동: IP → MAC 변환

### ✅ MAC 주소가 필요한 이유
- **로컬 통신**: 같은 LAN 내 직접 전달 필요
- **접근 제어**: MAC 주소 필터링으로 허용 장치 제한
- **라우터 통신**: 목적지 외부일 경우 라우터 MAC 필요
- **브로드캐스트 도메인 기반 전송**

---

## 3. IP vs MAC

| 구분 | IP 주소 | MAC 주소 |
|------|---------|-----------|
| 사용 계층 | 네트워크 계층 | 데이터 링크 계층 |
| 역할 | 목적지 네트워크 탐색 | 최종 장치 식별 및 전달 |
| 변경 여부 | 종단 간 유지 | 홉마다 변경 |
| 예시 | 네이버 서버로 향하는 경로 | 같은 LAN 내의 특정 장치 |

---

## 4. 기본 네트워크 통신 흐름

### 🔷 IP 주소
- 네트워크 계층에서 사용
- 목적지 경로를 결정

### 🔷 MAC 주소
- 데이터 링크 계층에서 사용
- 같은 네트워크 내 장비 식별

### 🔷 라우터 역할
- 다른 네트워크 연결
- 라우팅 테이블 기반 경로 선택
- 매 홉마다 다음 MAC 주소 결정

### 🔷 ARP 역할
- IP 주소 → MAC 주소 변환
- 매 홉마다 MAC 주소 탐색에 사용됨

---

## 5. 패킷 전송 흐름

### [1단계] 출발지 호스트
- 게이트웨이 라우터 MAC 주소 ARP 요청
- 패킷 구성:
  - 출발지 IP: 내 IP
  - 목적지 IP: 최종 목적지 IP
  - MAC 주소: 게이트웨이 MAC

### [2단계] 첫 라우터
- 목적지 IP 확인
- 다음 홉 결정
- 다음 홉 MAC 주소 ARP로 획득
- MAC 주소 재구성 후 전송

### [3단계] 중간 라우터
- 동일한 과정 반복 (목적지 IP는 동일, MAC 주소만 매번 갱신)

### [4단계] 최종 라우터 → 목적지
- 목적지 네트워크 여부 확인
- 목적지 MAC 주소 ARP 요청
- 최종 목적지로 패킷 전달

### ✅ 핵심 정리
- IP 주소: 종단 간 고정
- MAC 주소: 홉마다 변경
- ARP 사용 시점: MAC 주소를 모를 때마다 (게이트웨이, 라우터 등)

---

## 6. ARP 캐시

### ✅ 정의
- IP ↔ MAC 매핑 정보를 일시 저장하는 메모리

### ✅ 구성 요소
- IP 주소, MAC 주소, 타입(정적/동적), TTL

### ✅ 동작 방식
1. ARP 요청: MAC 주소 모를 때 브로드캐스트
2. ARP 응답: 해당 장비가 MAC 주소 응답 (유니캐스트)
3. 응답 결과 캐시에 저장

### ✅ 항목 종류
- **동적**: 자동 생성, 일정 시간 후 만료
- **정적**: 수동 추가, 만료 없음

### ✅ 확인 명령어
- Windows: `arp -a`
- Mac/Linux: `arp -n`

---

## 7. ARP 스푸핑 (보안 위협)

### ✅ 개념
- 위조된 ARP 응답을 보내 트래픽을 가로채는 공격
- 인증 없이 동작하는 ARP 구조의 취약점 악용

### ✅ 예시
- 공격자가 "나는 라우터야" 라는 위조 응답 전송
- 피해자 컴퓨터가 잘못된 MAC으로 저장
- 공격자가 중간자(Man-in-the-Middle) 역할

### ✅ 위험성
- 로그인 정보, 이메일, 계좌정보 유출 가능

### ✅ 대응 방법
- 정적 ARP 설정
- ARP 감시 도구 (arpwatch, XArp)
- 포트 보안 기능, Dynamic ARP Inspection
- HTTPS 등 암호화된 프로토콜 사용

---

## 8. ARP 전체 동작 흐름

### ✅ 네트워크 구분
- **같은 네트워크**: 목적지 MAC 요청
- **다른 네트워크**: 라우터 MAC 요청

| 내 IP | 목적지 IP | 판단 결과 | ARP 요청 대상 |
|-------|-----------|------------|----------------|
| 192.168.0.10/24 | 192.168.0.30/24 | 같은 네트워크 | 목적지 MAC |
| 192.168.0.10/24 | 192.168.1.100/24 | 다른 네트워크 | 게이트웨이 MAC |

### ✅ 동작 순서
1. ARP 캐시 확인
2. 없으면 브로드캐스트로 ARP 요청
3. 대상이 유니캐스트 응답
4. MAC 주소 저장 후 데이터 전송

---

## 9. 브로드캐스트 vs 유니캐스트

| 구분 | 브로드캐스트 | 유니캐스트 |
|------|---------------|------------|
| 대상 | 같은 LAN의 모든 호스트 | 지정된 하나의 호스트 |
| 예시 | ARP 요청, DHCP 요청 | ARP 응답, 일반 데이터 |
| 특성 | 전체 전파, 비효율적 | 정확한 대상, 효율적 |   

### ✅ 흐름 요약
ARP 캐시에 없음 → 브로드캐스트로 ARP 요청 → 대상이 유니캐스트로 응답 → 응답 MAC을 캐시에 저장 → 이후 유니캐스트로 데이터 전송
